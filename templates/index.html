{% extends "base.html" %}

{% block title %}NYC Events - Home{% endblock %}

{% block content %}
<div class="filter-container">
    <form method="GET" action="{{ url_for('index') }}" class="venue-filter-form">
        <label for="venue-filter">Filter by Venue:</label>
        <select name="venue" id="venue-filter" onchange="this.form.submit()">
            <option value="">All Venues</option>
            {% for venue in venues %}
                <option value="{{ venue }}" {% if venue_filter == venue %}selected{% endif %}>
                    {{ venue }}
                </option>
            {% endfor %}
        </select>
    </form>
</div>

{% if events %}
    
    <div class="events-table-container">
        <table class="events-table">
            <thead>
                <tr>
                    <th>Event Name</th>
                    <th>Date</th>
                    <th>Start Time</th>
                    <th>Venue Name</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr>
                    <td class="event-name">
                        {% if event.url %}
                            <a href="{{ event.url }}" target="_blank" class="event-link">
                                {{ event.title }}
                            </a>
                        {% else %}
                            {{ event.title }}
                        {% endif %}
                    </td>
                    <td class="event-date">
                        {% if event.start_time %}
                            {{ event.start_time.strftime('%m/%d/%y') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="event-time">
                        {% if event.start_time %}
                            {{ event.start_time.strftime('%I:%M %p') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="event-venue">
                        {% if event.display_venue %}
                            {{ event.display_venue }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if total_pages > 1 %}
    <div class="pagination">
        {% if has_prev %}
            <a href="{{ url_for('index', page=page-1, venue=venue_filter) }}">← Previous</a>
        {% endif %}
        
        {% for p in range(1, total_pages + 1) %}
            {% if p == page %}
                <span class="current">{{ p }}</span>
            {% elif p <= 5 or p > total_pages - 5 or (p >= page - 2 and p <= page + 2) %}
                <a href="{{ url_for('index', page=p, venue=venue_filter) }}">{{ p }}</a>
            {% elif p == 6 and page > 8 %}
                <span>...</span>
            {% elif p == total_pages - 5 and page < total_pages - 7 %}
                <span>...</span>
            {% endif %}
        {% endfor %}
        
        {% if has_next %}
            <a href="{{ url_for('index', page=page+1, venue=venue_filter) }}">Next →</a>
        {% endif %}
    </div>
    {% endif %}

{% else %}
    <div class="event-card">
        <h3>No Events Found</h3>
        <p>Try adjusting your search criteria or check back later for new events.</p>
    </div>
{% endif %}
{% endblock %}
